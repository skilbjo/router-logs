#!/usr/bin/env bash

firewall="firewall.local"
router="router.local"
user="root"
log_dir="./../logs"
command="cat /var/log/messages"

get_log(){
  device=$1
  log="$log_dir/$device"

  #ssh "$user@$device" "$command" > "$log"

  process $device $log
}

process(){
  device=$1
  log=$2
  processed="$log_dir/processed"

  awk 'BEGIN{OFS=",";} {print substr($0,1,15),substr($0,17,8),substr($0,26,500) ; }' "$log"  > "$processed"

  #load "$device" "$processed"
}

load() {
  device=$1
  processed=$2

  psql -h odroid -d router-logs -c "\copy log from '$processed' delimiter ',' csv;"
}

get_log $firewall
#get_log $router
